<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>IuComponentVersion.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">IU Java Utilities API Reference</a> &gt; <a href="../index.html" class="el_bundle">iu-java-type-api</a> &gt; <a href="index.source.html" class="el_package">edu.iu.type</a> &gt; <span class="el_source">IuComponentVersion.java</span></div><h1>IuComponentVersion.java</h1><pre class="source lang-java linenums">/*
 * Copyright Â© 2023 Indiana University
 * All rights reserved.
 *
 * BSD 3-Clause License
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * - Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * - Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * 
 * - Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
package edu.iu.type;

import java.util.HashMap;
import java.util.Hashtable;
import java.util.Objects;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * &lt;strong&gt;Refers&lt;/strong&gt; to a {@link IuComponent component's}
 * &lt;strong&gt;version&lt;/strong&gt;.
 * 
 * &lt;p&gt;
 * All {@link IuComponent components} are &lt;strong&gt;named&lt;/strong&gt; and may be
 * &lt;strong&gt;referred to&lt;/strong&gt; by &lt;strong&gt;version&lt;/strong&gt;. &lt;strong&gt;Version
 * references&lt;/strong&gt; are immutable, {@link Comparable comparable}, and
 * &lt;em&gt;must&lt;/em&gt; implement {@link #hashCode()} and {@link #equals(Object)}.
 * &lt;a href=&quot;https://semver.org/&quot;&gt;Semantic Versioning&lt;/a&gt; &lt;em&gt;must&lt;/em&gt; be used
 * to ensure consistency across a variety of &lt;strong&gt;components&lt;/strong&gt;.
 * &lt;/p&gt;
 *
 * &lt;p&gt;
 * A {@link IuComponent component's} &lt;strong&gt;implementation version&lt;/strong&gt; is
 * defined by its {@link IuComponent component archive}. A {@link IuComponent
 * dependency} &lt;em&gt;may&lt;/em&gt; require a specific {@link #implementationVersion()
 * implementation version}, or a minimum {@link #specificationVersion()
 * specification version}, to be present on the {@link IuComponent component's
 * path}.
 * &lt;/p&gt;
 * 
 * @see #implementationVersion()
 * @see #specificationVersion()
 */
public interface IuComponentVersion extends Comparable&lt;IuComponentVersion&gt; {

	/**
	 * Regular expression for validating a semantic version.
	 * 
	 * @see &lt;a href=&quot;https://semver.org/&quot;&gt;Semantic Versioning&lt;/a&gt;
	 */
<span class="fc" id="L73">	static final Pattern SEMANTIC_VERSION_PATTERN = Pattern.compile(</span>
			&quot;^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$&quot;);

	/**
	 * Gets the component &lt;strong&gt;name&lt;/strong&gt;.
	 * 
	 * &lt;p&gt;
	 * The component &lt;strong&gt;name&lt;/strong&gt; &lt;em&gt;should&lt;/em&gt; be universally unique,
	 * and &lt;em&gt;must&lt;/em&gt; be unique within the {@link IuComponent component's path}.
	 * The &lt;strong&gt;name&lt;/strong&gt; is part of of the {@link IuComponent component's}
	 * version.
	 * &lt;/p&gt;
	 * 
	 * @return name
	 */
	String name();

	/**
	 * Gets the &lt;strong&gt;implementation version&lt;/strong&gt; of a {@link IuComponent
	 * component} or &lt;strong&gt;dependency&lt;/strong&gt;.
	 * 
	 * &lt;p&gt;
	 * &lt;em&gt;Must&lt;/em&gt; return a value for which
	 * {@link #SEMANTIC_VERSION_PATTERN}{@link Pattern#matcher(CharSequence)
	 * .matcher(implementationVersion())}{@link Matcher#matches() .matches()}
	 * returns {@code true}, or {@code null}.
	 * &lt;/p&gt;
	 * 
	 * @return Full &lt;a href=&quot;https://semver.org/&quot;&gt;Semantic&lt;/a&gt;
	 *         &lt;strong&gt;implementation version&lt;/strong&gt; of the {@link IuComponent
	 *         component}.&lt;br&gt;
	 *         &lt;em&gt;May&lt;/em&gt; be {@code null} when referring to a
	 *         &lt;strong&gt;dependency&lt;/strong&gt; on the &lt;strong&gt;component's specification
	 *         version&lt;/strong&gt;.&lt;br&gt;
	 *         &lt;em&gt;Must&lt;/em&gt; {@link String#startsWith(String) start with}
	 *         {@code major() + '.' + minor() + '.'} when {@code non-null}.
	 */
	String implementationVersion();

	/**
	 * Gets the &lt;strong&gt;major&lt;/strong&gt; version number as defined by
	 * &lt;a href=&quot;https://semver.org/&quot;&gt;Semantic Versioning&lt;/a&gt;.
	 * 
	 * @return &lt;strong&gt;Major&lt;/strong&gt; version; &lt;em&gt;must&lt;/em&gt; be non-negative,
	 *         &lt;em&gt;should&lt;/em&gt; be positive. Non-development applications
	 *         &lt;em&gt;may&lt;/em&gt; reject &lt;strong&gt;versions&lt;/strong&gt; with a major version of
	 *         {@code 0}.
	 */
	int major();

	/**
	 * Gets the &lt;strong&gt;minor&lt;/strong&gt; version number as defined by
	 * &lt;a href=&quot;https://semver.org/&quot;&gt;Semantic Versioning&lt;/a&gt;.
	 * 
	 * @return &lt;strong&gt;Minor&lt;/strong&gt; version; &lt;em&gt;must&lt;/em&gt; be non-negative
	 */
	int minor();

	/**
	 * Gets the &lt;strong&gt;specification version&lt;/strong&gt; implied by this
	 * &lt;strong&gt;version reference&lt;/strong&gt;.
	 * 
	 * &lt;p&gt;
	 * The &lt;strong&gt;specification version&lt;/strong&gt; relates to the
	 * &lt;strong&gt;minor&lt;/strong&gt; version of the &lt;strong&gt;implementation&lt;/strong&gt;. For
	 * example, if the &lt;strong&gt;implementation version&lt;/strong&gt; is {@code
	 * 1.2.34-SNAPSHOT}, then the &lt;strong&gt;specification version&lt;/strong&gt; is
	 * {@code 1.2}.
	 * &lt;/p&gt;
	 * 
	 * @return &lt;strong&gt;Specification version&lt;/strong&gt; implied by this
	 *         &lt;strong&gt;version reference&lt;/strong&gt;. For an &lt;strong&gt;implementation
	 *         version&lt;/strong&gt;, the version of the &lt;strong&gt;implemented
	 *         specification&lt;/strong&gt; is returned. For a &lt;strong&gt;specification
	 *         version&lt;/strong&gt;, {@code this} is returned.
	 * @see #major()
	 * @see #minor()
	 */
	default IuComponentVersion specificationVersion() {
<span class="fc" id="L152">		var implementationVersion = implementationVersion();</span>
<span class="fc bfc" id="L153" title="All 2 branches covered.">		if (implementationVersion == null)</span>
<span class="fc" id="L154">			return this;</span>
		else
<span class="fc" id="L156">			return new IuComponentVersion() {</span>
				@Override
				public String name() {
<span class="fc" id="L159">					return IuComponentVersion.this.name();</span>
				}

				@Override
				public String implementationVersion() {
<span class="fc" id="L164">					return null;</span>
				}

				@Override
				public int major() {
<span class="fc" id="L169">					return IuComponentVersion.this.major();</span>
				}

				@Override
				public int minor() {
<span class="fc" id="L174">					return IuComponentVersion.this.minor();</span>
				}

				@Override
				public int hashCode() {
<span class="fc" id="L179">					return Objects.hash(major(), minor(), name(), null);</span>
				}

				@Override
				public boolean equals(Object obj) {
<span class="fc bfc" id="L184" title="All 2 branches covered.">					if (this == obj)</span>
<span class="fc" id="L185">						return true;</span>
<span class="fc bfc" id="L186" title="All 2 branches covered.">					if (obj == null)</span>
<span class="fc" id="L187">						return false;</span>
<span class="fc bfc" id="L188" title="All 2 branches covered.">					if (!(obj instanceof IuComponentVersion))</span>
<span class="fc" id="L189">						return false;</span>

<span class="fc" id="L191">					IuComponentVersion other = (IuComponentVersion) obj;</span>
<span class="fc bfc" id="L192" title="All 6 branches covered.">					return major() == other.major() &amp;&amp; minor() == other.minor() &amp;&amp; Objects.equals(name(), other.name())</span>
<span class="fc bfc" id="L193" title="All 2 branches covered.">							&amp;&amp; other.implementationVersion() == null;</span>
				}

				@Override
				public String toString() {
<span class="fc" id="L198">					return name() + '-' + major() + '.' + minor() + '+';</span>
				}
			};
	}

	/**
	 * Determines if the &lt;strong&gt;version&lt;/strong&gt; implied by {@code this}
	 * &lt;strong&gt;version reference&lt;/strong&gt; meets the &lt;strong&gt;version&lt;/strong&gt;
	 * required by another &lt;strong&gt;version reference&lt;/strong&gt;.
	 * 
	 * &lt;p&gt;
	 * Note that {@link #compareTo(IuComponentVersion) comparing} two
	 * &lt;strong&gt;version references&lt;/strong&gt; is not sufficient to determine if a
	 * &lt;strong&gt;dependency&lt;/strong&gt; requirement is met since the {@link #major()
	 * major versions} &lt;em&gt;must&lt;/em&gt; be identical in order to consider the
	 * requirement met.
	 * &lt;/p&gt;
	 * 
	 * @param requiredVersion &lt;strong&gt;Reference&lt;/strong&gt; to the required
	 *                        &lt;strong&gt;version&lt;/strong&gt;.
	 * @return True if the {@code this} &lt;strong&gt;refers to&lt;/strong&gt; a
	 *         &lt;strong&gt;version&lt;/strong&gt; with the same {@link #name() name}, and
	 *         either the same {@link #implementationVersion() implementation
	 *         version} or same {@link #major() major version} and the same or
	 *         higher {@link #minor() minor version} as the &lt;strong&gt;version
	 *         reference&lt;/strong&gt; passed as an argument to the
	 *         {@code requiredVersion} parameter.
	 */
	default boolean meets(IuComponentVersion requiredVersion) {
<span class="fc bfc" id="L227" title="All 2 branches covered.">		if (!name().equals(requiredVersion.name()))</span>
<span class="fc" id="L228">			return false;</span>

<span class="fc" id="L230">		var requiredImplementationVersion = requiredVersion.implementationVersion();</span>
<span class="fc bfc" id="L231" title="All 2 branches covered.">		if (requiredImplementationVersion != null)</span>
<span class="fc" id="L232">			return requiredImplementationVersion.equals(implementationVersion());</span>
		else
<span class="fc bfc" id="L234" title="All 4 branches covered.">			return major() == requiredVersion.major() &amp;&amp; minor() &gt;= requiredVersion.minor();</span>
	}

	/**
	 * Compares two &lt;strong&gt;version references&lt;/strong&gt;.
	 * 
	 * &lt;ul&gt;
	 * &lt;li&gt;&lt;strong&gt;Version references&lt;/strong&gt; with different {@link #name() names}
	 * &lt;em&gt;must not&lt;/em&gt; return {@code 0}; otherwise, the return value enforces
	 * natural ordering of the {@link #name() component name}.&lt;/li&gt;
	 * &lt;li&gt;An {@link #implementationVersion() implementation version} compared to
	 * another {@link #implementationVersion() implementation version} will return a
	 * value that:
	 * &lt;ul&gt;
	 * &lt;li&gt;enforces the numeric order of the {@link #major() major}, {@link #minor()
	 * minor}, and &lt;a href=&quot;https://semver.org/&quot;&gt;patch&lt;/a&gt; version numbers&lt;/li&gt;
	 * &lt;li&gt;enforces the natural order (i.e. +build.12, -SNAPSHOT, -alpha.2, -beta.1)
	 * of the combined &lt;a href=&quot;https://semver.org/&quot;&gt;build and pre-release
	 * identifiers&lt;/a&gt;&lt;/li&gt;
	 * &lt;li&gt;is {@code 0} when {@link #implementationVersion()} strings are
	 * identical&lt;/li&gt;
	 * &lt;/ul&gt;
	 * &lt;/li&gt;
	 * &lt;li&gt;A {@link #specificationVersion() specification version} compared to
	 * another &lt;strong&gt;version&lt;/strong&gt; will return a value that enforces the
	 * numeric order of the {@link #major() major} and {@link #minor() minor}
	 * version numbers&lt;/li&gt;
	 * &lt;li&gt;An {@link #implementationVersion() implementation version} is greater
	 * than a {@link #specificationVersion() specification version} with matching
	 * {@link #major() major} and {@link #minor() minor} version numbers&lt;/li&gt;
	 * &lt;/ul&gt;
	 * 
	 * &lt;p&gt;
	 * Note that comparing two &lt;strong&gt;version references&lt;/strong&gt; is not sufficient
	 * to determine if a &lt;strong&gt;dependency&lt;/strong&gt; requirement is
	 * {@link #meets(IuComponentVersion) met} since the {@link #major() major
	 * versions} &lt;em&gt;must&lt;/em&gt; be identical in order to consider the requirement
	 * met.
	 * &lt;/p&gt;
	 * 
	 * &lt;p&gt;
	 * Note that all &lt;strong&gt;versions&lt;/strong&gt; are case-sensitive.
	 * &lt;/p&gt;
	 * 
	 * {@inheritDoc}
	 */
	@Override
	default int compareTo(IuComponentVersion o) {
<span class="fc" id="L282">		int rv = name().compareTo(o.name());</span>
<span class="fc bfc" id="L283" title="All 2 branches covered.">		if (rv != 0)</span>
<span class="fc" id="L284">			return rv;</span>

<span class="fc" id="L286">		var iv1 = implementationVersion();</span>
<span class="fc" id="L287">		var iv2 = o.implementationVersion();</span>
<span class="fc bfc" id="L288" title="All 4 branches covered.">		if (iv1 != null &amp;&amp; iv1.equals(iv2))</span>
<span class="fc" id="L289">			return 0;</span>

<span class="fc" id="L291">		var x1 = major();</span>
<span class="fc" id="L292">		var x2 = o.major();</span>
<span class="fc" id="L293">		rv = Integer.compare(x1, x2);</span>
<span class="fc bfc" id="L294" title="All 2 branches covered.">		if (rv != 0)</span>
<span class="fc" id="L295">			return rv;</span>

<span class="fc" id="L297">		var y1 = minor();</span>
<span class="fc" id="L298">		var y2 = o.minor();</span>
<span class="fc" id="L299">		rv = Integer.compare(y1, y2);</span>
<span class="fc bfc" id="L300" title="All 2 branches covered.">		if (rv != 0)</span>
<span class="fc" id="L301">			return rv;</span>

<span class="fc bfc" id="L303" title="All 2 branches covered.">		if (iv1 == iv2) // both null</span>
<span class="fc" id="L304">			return 0;</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">		else if (iv1 == null)</span>
<span class="fc" id="L306">			return -1;</span>
<span class="fc bfc" id="L307" title="All 2 branches covered.">		else if (iv2 == null)</span>
<span class="fc" id="L308">			return 1;</span>

<span class="fc" id="L310">		var m1 = SEMANTIC_VERSION_PATTERN.matcher(iv1);</span>
<span class="fc bfc" id="L311" title="All 2 branches covered.">		if (!m1.matches())</span>
<span class="fc" id="L312">			throw new IllegalStateException();</span>
<span class="fc" id="L313">		var z1 = Integer.parseInt(m1.group(3));</span>

<span class="fc" id="L315">		var m2 = SEMANTIC_VERSION_PATTERN.matcher(iv2);</span>
<span class="fc bfc" id="L316" title="All 2 branches covered.">		if (!m2.matches())</span>
<span class="fc" id="L317">			throw new IllegalStateException();</span>
<span class="fc" id="L318">		var z2 = Integer.parseInt(m2.group(3));</span>

<span class="fc" id="L320">		rv = Integer.compare(z1, z2);</span>
<span class="fc bfc" id="L321" title="All 2 branches covered.">		if (rv != 0)</span>
<span class="fc" id="L322">			return rv;</span>

<span class="fc" id="L324">		return iv1.compareTo(iv2);</span>
	}

	/**
	 * &lt;p&gt;
	 * Note that when using {@link IuComponentVersion} in a {@link Set} or as a key
	 * in a {@link HashMap} or {@link Hashtable} that is important to be aware
	 * whether of whether or not the members and/or keys are expected to represent a
	 * {@link #specificationVersion() specification version}.
	 * &lt;/p&gt;
	 * 
	 * {@inheritDoc}
	 */
	@Override
	int hashCode();

	/**
	 * &lt;p&gt;
	 * Two &lt;strong&gt;implementation versions&lt;/strong&gt; are {@link Object#equals(Object)
	 * equal} if both {@link #name() name} and {@link #implementationVersion()
	 * implementation version} are equal. Two &lt;strong&gt;specification
	 * versions&lt;/strong&gt; are {@link Object#equals(Object) equal} if {@link #name()},
	 * {@link #major()}, and {@link #minor()} are equal.
	 * &lt;/p&gt;
	 * 
	 * &lt;p&gt;
	 * An &lt;strong&gt;implementation version&lt;/strong&gt; is never
	 * {@link Object#equals(Object) equal} to a &lt;strong&gt;specification
	 * version&lt;/strong&gt;.
	 * &lt;/p&gt;
	 * 
	 * &lt;p&gt;
	 * Note that &lt;strong&gt;versions&lt;/strong&gt; are case-sensitive.
	 * &lt;/p&gt;
	 * 
	 * {@inheritDoc}
	 */
	@Override
	boolean equals(Object o);

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>