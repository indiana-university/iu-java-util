<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>IuAuthorizationClient.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">IU Java Utilities API Reference</a> &gt; <a href="../index.html" class="el_bundle">iu-java-auth-config</a> &gt; <a href="index.source.html" class="el_package">edu.iu.auth.config</a> &gt; <span class="el_source">IuAuthorizationClient.java</span></div><h1>IuAuthorizationClient.java</h1><pre class="source lang-java linenums">/*
 * Copyright Â© 2024 Indiana University
 * All rights reserved.
 *
 * BSD 3-Clause License
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * - Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * - Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * 
 * - Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
package edu.iu.auth.config;

import java.time.Duration;
import java.time.Instant;
import java.util.Set;

import edu.iu.IuIterable;
import edu.iu.client.IuJson;
import edu.iu.client.IuJsonAdapter;
import iu.auth.config.AuthConfig;
import jakarta.json.JsonString;

/**
 * Provides client configuration.
 */
public interface IuAuthorizationClient {

	/**
	 * JSON type adapter.
	 */
<span class="fc" id="L52">	static final IuJsonAdapter&lt;IuAuthorizationClient&gt; JSON = IuJsonAdapter.from(v -&gt; {</span>
<span class="fc bfc" id="L53" title="All 2 branches covered.">		if (v instanceof JsonString)</span>
<span class="fc" id="L54">			return of(((JsonString) v).getString());</span>
		else
<span class="fc" id="L56">			return IuJson.wrap(v.asJsonObject(), IuAuthorizationClient.class, AuthConfig::adaptJson);</span>
	}, IuJson::unwrap);

	/**
	 * Enumerate token endpoint authentication methods types.
	 */
<span class="fc" id="L62">	enum AuthMethod {</span>

		/**
		 * Direct use of client secret as password at API endpoint via Authorization
		 * Basic header.
		 */
<span class="fc" id="L68">		@Deprecated</span>
<span class="fc" id="L69">		BASIC(&quot;basic&quot;, Duration.ofDays(45L), true),</span>

		/**
		 * Direct use of access token at API endpoint via Authorization Bearer header.
		 * 
		 * &lt;p&gt;
		 * Not intended for client configuration except in development environments.
		 * &lt;/p&gt;
		 */
<span class="fc" id="L78">		BEARER(&quot;bearer&quot;, Duration.ofHours(12L), false),</span>

		/**
		 * Bearer token w/ use of client secret as password at token endpoint via
		 * Authorization Basic header.
		 */
<span class="fc" id="L84">		@Deprecated</span>
<span class="fc" id="L85">		CLIENT_SECRET_BASIC(&quot;client_secret_basic&quot;, Duration.ofDays(45L), true),</span>

		/**
		 * Bearer token w/ use of client secret as password at token endpoint via POST
		 * parameter.
		 */
<span class="fc" id="L91">		@Deprecated</span>
<span class="fc" id="L92">		CLIENT_SECRET_POST(&quot;client_secret_post&quot;, Duration.ofDays(45L), true),</span>

		/**
		 * Bearer token w/ use of client secret as HMAC key for signing a JWT assertion.
		 */
<span class="fc" id="L97">		CLIENT_SECRET_JWT(&quot;client_secret_jwt&quot;, Duration.ofDays(455L), false),</span>

		/**
		 * Bearer token w/ use of X509 certificate to demonstrate proof of private key
		 * possession via JWT assertion.
		 */
<span class="fc" id="L103">		PRIVATE_KEY_JWT(&quot;private_key_jwt&quot;, Duration.ofDays(830L), false);</span>

		/**
		 * JSON type adapter.
		 */
<span class="fc" id="L108">		public static IuJsonAdapter&lt;AuthMethod&gt; JSON = IuJsonAdapter.text(AuthMethod::from, a -&gt; a.parameterValue);</span>

		/**
		 * Gets an authentication method from standard parameter value.
		 * 
		 * @param parameterValue standard parameter value
		 * @return {@link AuthMethod}
		 */
		public static AuthMethod from(String parameterValue) {
<span class="fc" id="L117">			return IuIterable.select(IuIterable.iter(AuthMethod.values()),</span>
<span class="fc" id="L118">					a -&gt; a.parameterValue.equals(parameterValue));</span>
		}

		/**
		 * Standard parameter value.
		 */
		public final String parameterValue;

		/**
		 * Designates the minimum duration to allow for client configuration to expire
		 * with the auth method enabled.
		 */
		public final Duration ttlPolicy;

		/**
		 * True if IP restrictions are required in order to use this authentication
		 * method.
		 */
		public final boolean requiresIpAllow;

<span class="fc" id="L138">		private AuthMethod(String parameterValue, Duration ttlPolicy, boolean requiresIpAllow) {</span>
<span class="fc" id="L139">			this.parameterValue = parameterValue;</span>
<span class="fc" id="L140">			this.ttlPolicy = ttlPolicy;</span>
<span class="fc" id="L141">			this.requiresIpAllow = requiresIpAllow;</span>
<span class="fc" id="L142">		}</span>
	}

	/**
	 * Enumerates grant types.
	 * 
	 * @see &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc7591#section-2&quot;&gt;OAuth
	 *      2.0 Dynamic Client Registration&lt;/a&gt;
	 */
<span class="fc" id="L151">	enum GrantType {</span>

		/**
		 * Authorization code.
		 * 
		 * @see &lt;a href=
		 *      &quot;https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth&quot;&gt;OIDC
		 *      Core 1.0 Section 3.1&lt;/a&gt;
		 */
<span class="fc" id="L160">		AUTHORIZATION_CODE(&quot;code&quot;),</span>

		/**
		 * Client credentials.
		 * 
		 * @see &lt;a href=
		 *      &quot;https://datatracker.ietf.org/doc/html/rfc6749#section-4.4&quot;&gt;OAuth 2.0
		 *      Section 4.4&lt;/a&gt;
		 */
<span class="fc" id="L169">		CLIENT_CREDENTIALS(&quot;client_credentials&quot;),</span>

		/**
		 * Resource owner password.
		 * 
		 * @see &lt;a href=
		 *      &quot;https://datatracker.ietf.org/doc/html/rfc6749#section-4.3&quot;&gt;OAuth 2.0
		 *      Section 4.3&lt;/a&gt;
		 */
<span class="fc" id="L178">		PASSWORD(&quot;password&quot;),</span>

		/**
		 * Refresh token.
		 * 
		 * @see &lt;a href=
		 *      &quot;https://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess&quot;&gt;OIDC
		 *      Core 1.0 Section 11&lt;/a&gt;
		 */
<span class="fc" id="L187">		REFRESH_TOKEN(&quot;refresh_token&quot;),</span>

		/**
		 * JWT bearer assertion.
		 * 
		 * @see &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc7523&quot;&gt;OAuth 2.0 JWT
		 *      Bearer Token Profiles&lt;/a&gt;
		 */
<span class="fc" id="L195">		JWT_BEARER(&quot;urn:ietf:params:oauth:grant-type:jwt-bearer&quot;);</span>

		/**
		 * JSON type adapter.
		 */
<span class="fc" id="L200">		public static IuJsonAdapter&lt;GrantType&gt; JSON = IuJsonAdapter.text(GrantType::from, a -&gt; a.parameterValue);</span>

		/**
		 * Gets a grant type from parameter value.
		 * 
		 * @param parameterValue standard parameter value
		 * @return {@link GrantType}
		 */
		public static GrantType from(String parameterValue) {
<span class="fc" id="L209">			return IuIterable.select(IuIterable.iter(GrantType.values()), a -&gt; a.parameterValue.equals(parameterValue));</span>
		}

		/**
		 * Standard parameter value.
		 */
		public final String parameterValue;

<span class="fc" id="L217">		private GrantType(String parameterValue) {</span>
<span class="fc" id="L218">			this.parameterValue = parameterValue;</span>
<span class="fc" id="L219">		}</span>

	}

	/**
	 * Defines credentials issued to this client.
	 */
	interface Credentials extends IuPrivateKeyPrincipal {

		/**
		 * JSON type adapter.
		 */
<span class="fc" id="L231">		static IuJsonAdapter&lt;Credentials&gt; JSON = IuJsonAdapter</span>
<span class="fc" id="L232">				.from(v -&gt; IuJson.wrap(v.asJsonObject(), Credentials.class, AuthConfig::adaptJson), IuJson::unwrap);</span>

		/**
		 * Gets the grant types the credentials are authorized for use with.
		 * 
		 * @return {@link Set} of {@link GrantType}
		 */
		Set&lt;GrantType&gt; getGrantTypes();

		/**
		 * Gets allowed authentication method.
		 * 
		 * @return {@link AuthMethod}
		 */
		AuthMethod getTokenEndpointAuthMethod();

		/**
		 * Gets the point in time the credentials expire.
		 * 
		 * @return {@link Instant}
		 */
		Instant getExpires();

	}

	/**
	 * Gets the configuration for a client.
	 * 
	 * @param name client name
	 * @return client configuration
	 */
	static IuAuthorizationClient of(String name) {
<span class="fc" id="L264">		return AuthConfig.load(IuAuthorizationClient.class, &quot;client/&quot; + name);</span>
	}

	/**
	 * Gets the scope of access authorized to this client.
	 * 
	 * @return authorized scopes
	 */
	Set&lt;String&gt; getScope();

	/**
	 * Gets the allowed IP address ranges.
	 * 
	 * @return Set of allowed IP address ranges
	 */
	Set&lt;String&gt; getIpAllow();

	/**
	 * Defines the maximum time to live for assertions issued by this client.
	 * 
	 * @return {@link Duration}
	 */
	Duration getAssertionTtl();

	/**
	 * Gets credentials issued to this client.
	 * 
	 * @return {@link Credentials}
	 */
	Iterable&lt;Credentials&gt; getCredentials();

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>